<!DOCTYPE html>
<html>
<head>
	<title>Spritx</title>
	<meta charset="UTF-8"/>
	<style type="text/css">
		.box {
			margin: 100px auto 20px auto;
			width: 350px;
			border-top: 3px solid black;
			border-bottom: 3px solid black;
		}
		.word {
			margin-left: 100px;
			font-size: 24px;
			font-family: Consolas;
		}
		.red {
			color: red;
		}
		.marker {
			width: 132px;
			height: 10px;
			border-right: 1px solid black;
		}
	</style>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
	<script type="text/javascript">
		function wait(ms) {
			var deferred = $.Deferred();
			setTimeout(function(){deferred.resolve()}, ms);
			return deferred.promise();
		}

		function render(left, center, right) {
			var e = left.replace(/\s/g, '&nbsp;') + "<span class='red'>"+center+"</span>"+right;
			$(".word").html(e);
		}

		function iter (words, i, ms) {

			if (words.length <= i) {
				$("#btn-start").removeAttr("disabled");
				return;
			}

			var word = words[i];

			var delay = 0;
			if (word.length > 8) {
				delay = 100;
			}

			render(word.substr(0,2), word[2], word.substr(3));
			wait(ms+delay).done(function(){iter(words, i+1, ms)});

		}

		function normalizeWord(word) {
			word = word.trim();
			while (word.length < 3) {
				word = " " + word;
			} 
			return word;
		}

		$(document).ready(function() {	
			$("#btn-start").click(function() {
				var url = $("#articleUrl").val();
				if (url.length == 0) {
					return;
				}

				$(this).attr("disabled", "disabled");

				$.getJSON("https://www.readability.com/api/content/v1/parser?url="+ url +"&token=74e9c9a322e162f0dee87e8425ce209eeea0643e&callback=?", function (data) {
					var text = data.title + " " + $('<div />').html(data.content).text();					
					var words = text.split(/[ \n]+/)
									.filter(function(word){return word.trim().length > 0})
									.map(normalizeWord);

					$(".word").fadeOut(500, function(){$(this).empty()}).fadeIn(function(){iter(words, 0, 250)});
	        	});
			});
		});
	</script>
</head>
<body>

	<div class="box">
		<div class="marker"></div>
		<span class="word">Pr<span class="red">e</span>ss the button</span>
		<div class="marker"></div>
	</div>
	<div style="text-align:center">
		<form action="javascript:void(0);">
			<input type="text" placeholder="Enter article URL" id="articleUrl"/>
			<button id="btn-start">Start</button>	
		</form>
	</div>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-29178854-1', 'renatn.com');
	  ga('send', 'pageview');

	</script>

</body>
</html>