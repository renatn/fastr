<!DOCTYPE html>
<html>
<head>
	<title>Spritx</title>
	<meta charset="UTF-8"/>
	<style type="text/css">
		.box {
			margin: 100px auto 20px auto;
			width: 450px;
			border-top: 2px solid black;
			border-bottom: 2px solid black;
		}
		.word {
			margin-left: 100px;
			font-size: 24px;
			font-family: Consolas;
		}
		.red {
			color: red;
		}
		.marker {
			width: 132px;
			height: 10px;
			border-right: 1px solid black;
		}
	</style>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
	<script src="http://fgnass.github.io/spin.js/spin.min.js"></script>
	<script type="text/javascript">

		function render(left, center, right) {
			var e = left.replace(/\s/g, '&nbsp;') + "<span class='red'>"+center+"</span>"+right;
			$(".word").html(e);
		}

		function normalizeWord(word) {
			word = word.trim();
			while (word.length < 3) {
				word = " " + word;
			} 
			return word;
		}

		function wait(ms, pause) {
			var deferred = $.Deferred();
			setTimeout(function(){deferred.resolve()}, ms);
			return deferred.promise();
		}


		$(document).ready(function() {	

			var spinner = new Spinner();
			var $btnStart = $("#btn-start");
			var $btnPause = $("#btn-pause");

			var paused = false;
			var speed = 250;
			var index = 0;
			var words = [];

			function iter () {
				if (words.length <= index) {
					$btnStart.removeAttr("disabled");
					$btnPause.attr("disabled", "disabled");
					index = 0;
					return;
				}

				var word = words[index];

				var delay = 0;
				if (word.length > 8) {
					delay = 100;
				}

				render(word.substr(0,2), word[2], word.substr(3));
				index = index + 1;

				if (!paused) {
					wait(speed+delay).done(function(){
						iter();
					});
					return;
				}
			}


			$btnStart.click(function() {
				var url = $("#articleUrl").val();
				if (url.length == 0) {
					return;
				}
				
				$btnStart.attr("disabled", "disabled");
				$btnPause.removeAttr("disabled");

				var container = document.getElementById("spinContainer");
				spinner.spin(container);

				$.getJSON("https://www.readability.com/api/content/v1/parser?url="+ url +"&token=74e9c9a322e162f0dee87e8425ce209eeea0643e&callback=?", function (data) {
					var text = data.title + " " + $('<div />').html(data.content).text();					
					words = text.split(/[ \n]+/)
									.filter(function(word){return word.trim().length > 0})
									.map(normalizeWord);

					$(".word").fadeOut(500, function(){$(this).empty()}).fadeIn(function(){iter()});
					
					// $("#spritzer").data("controller").startSpritzing(text);
					$("#spritzer").data("controller").setSpritzText(text);

	        	}).always(function() { spinner.stop()});


			});

			$btnPause.click(function() {
				paused = !paused;
				if (paused) {
					$(this).text("Continue");
				} else {
					$(this).text("Pause");
					iter();
				}
			});	

			$("#btn-faster").click(function() {
				speed = speed - 25;
				if (speed < 100) {
					speed = 100;
				}
			});

			$("#btn-slower").click(function() {
				speed = speed + 25;
			});

		});
	</script>

	<script type="text/javascript">
         var SpritzSettings = {
                  clientId: "5ba714540fabf77dc",
                  redirectUri: "http://renatn.com/spritx/login_success.html",

   		};
	</script>
	<script id="spritzjs" type="text/javascript" src="http://sdk.spritzinc.com/js/1.0/js/spritz.min.js"></script>
</head>
<body>

	<div class="box">
		<div class="marker"></div>
		<span class="word">Pr<span class="red">e</span>ss the button</span>
		<div class="marker"></div>
	</div>
	<div style="text-align:center">
		<form action="javascript:void(0);">
			<input type="text" placeholder="Enter article URL" id="articleUrl"/>
			<button id="btn-start">Start</button>	
			<button id="btn-pause" disabled>Pause</button>	
			<button id="btn-faster">Faster</button>	
			<button id="btn-slower">Slower</button>	
		</form>
	</div>

	<div id="spinContainer"></div>

	<p><div id="spritzer" data-role="spritzer"></div><p>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-29178854-1', 'renatn.com');
	  ga('send', 'pageview');

	</script>

</body>
</html>